!function(t){var e={};function r(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(s,n,function(e){return t[e]}.bind(null,n));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=9)}([function(t,e,r){"use strict";r.d(e,"d",(function(){return s})),r.d(e,"b",(function(){return n})),r.d(e,"c",(function(){return i})),r.d(e,"a",(function(){return o})),r.d(e,"f",(function(){return a})),r.d(e,"e",(function(){return u})),r.d(e,"g",(function(){return l}));const s=3,n=7,i=3,o=20,a={isRequired:"Нужно ввести ключевое слово"},u={none:"none",block:"block",flex:"flex"},l={newsArticles:"newsArticles",newsCount:"newsCount",keyword:"keyword"}},function(t,e,r){"use strict";function s(t){const e=new Date(t).toLocaleDateString("ru-Ru",{day:"numeric",month:"long",year:"numeric"}).slice(0,-3).split(" ");return`${e[0]} ${e[1]}, ${e[2]}`}function n(t){return new Date(t).toLocaleDateString("ru-Ru",{day:"numeric",weekday:"short",month:"long",year:"numeric"})}function i(t){return t.split(", ")[1].split(" ")[1]}function o(t){const e=t.split(", "),r=e[0];return`${e[1].split(" ")[0]}, ${r}`}function a(t){return t.split("T")[0]}r.d(e,"a",(function(){return s})),r.d(e,"b",(function(){return n})),r.d(e,"d",(function(){return i})),r.d(e,"c",(function(){return o})),r.d(e,"e",(function(){return a}))},function(t,e,r){"use strict";r.d(e,"a",(function(){return s}));const s={newsUrl:"http://newsapi.org/v2/",prodNewsUrl:"https://newsapi.org/v2/",newsApiKey:"75f7ee7dea7f44568a2f942cef7db716",githubUrl:"http://api.github.com/repos/diazometan/NewsAnalyzer/commits",prodGithubUrl:"https://api.github.com/repos/diazometan/NewsAnalyzer/commits"}},function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var s=r(0);class n{constructor(){}setNews(t){localStorage.setItem(s.g.newsArticles,JSON.stringify(t.articles)),localStorage.setItem(s.g.newsCount,JSON.stringify(t.totalResults))}getNews(){return JSON.parse(localStorage.getItem(s.g.newsArticles))}getNewsCount(){return localStorage.getItem(s.g.newsCount)}setKeyword(t){localStorage.setItem(s.g.keyword,t)}getKeyword(){return localStorage.getItem(s.g.keyword)}clear(){localStorage.clear()}}},function(t,e,r){},,,,,function(t,e,r){"use strict";r.r(e);r(4);var s=r(2),n=r(0),i=r(1);var o=r(3);class a{constructor(t,e){this._newsInfo=t,this._cardTemplate=e}create(){const t=this._cardTemplate.content.cloneNode(!0).querySelector(".card");t.href=this._newsInfo.urlToNews,this._newsInfo.urlToImage&&(t.querySelector(".card__image").src=this._newsInfo.urlToImage);const e=t.querySelector(".card__text");return e.querySelector(".card__date").textContent=Object(i.a)(this._newsInfo.publishedAt),e.querySelector(".card__title").textContent=this._newsInfo.title,e.querySelector(".card__discription").textContent=this._newsInfo.description,e.querySelector(".card__author").textContent=this._newsInfo.author,t}}class u{constructor(t,e,r,s,n,i){this.author=t,this.title=e,this.publishedAt=Date.parse(r),this.description=s,this.urlToImage=n,this.urlToNews=i}}const l=document.querySelector(".search-result"),c=document.querySelector(".search__form"),d=document.querySelector('[data-component="NewsCardTemplate"]'),h=new class{constructor(t){this._baseUrl=t.baseUrl,this._headers=t.headers,this._apiKey=t.apiKey,this._methods={get:"GET"}}getNews(t){return fetch(this._baseUrl+this._createGetRequestUrl(t),{method:this._methods.get,headers:this._headers}).then(t=>t.ok?t.json():Promise.reject("Ошибка: "+t.status)).catch(t=>{throw t})}_createGetRequestUrl(t){const e=new Date,r=new Date;return r.setDate(r.getDate()-n.b),`everything?q=${t}&language=ru&from=${Object(i.e)(r.toISOString())}&to=${Object(i.e)(e.toISOString())}&page=1&pageSize=100&sortBy=publishedAt&apiKey=`+this._apiKey}}({baseUrl:s.a.prodNewsUrl,apiKey:s.a.newsApiKey,headers:{}}),_=new o.a,p=new class{constructor(t,e,r,s,n){this._container=t.querySelector(".cards"),this._button=t.querySelector(".search-result__button"),this._resultFoundElem=t.querySelector(".search-result__found"),this._loadingElem=t.querySelector(".search-result__loading"),this._notFoundElem=t.querySelector(".search-result__not-found"),this._failedElem=t.querySelector(".search-result__failed"),this._cardFactory=e,this._cardTemplate=n,this._currentCount=0,this._totalCount=0,this._api=r,this._dataStorage=s,this._showMore=this._showMore.bind(this),this.render=this.render.bind(this),this.renderFromLS=this.renderFromLS.bind(this)}addEventListener(){this._button.addEventListener("click",this._showMore)}renderFromLS(t){this._resetContainer(),this._totalCount=t.length,this._addCards(t.slice(0,n.d)),this._showResponse()}render(t){this._resetContainer(),this._startLoading(),this._api.getNews(t).then(e=>{this._dataStorage.setNews(e),this._dataStorage.setKeyword(t);const r=e.articles.length>n.d?n.d:e.articles.length;this._totalCount=e.articles.length,this._addCards(e.articles.slice(0,r)),this._showResponse()}).catch(()=>{this._showError()})}_showMore(){const t=this._dataStorage.getNews().slice(this._currentCount,this._currentCount+n.d);this._addCards(t),this._hideShowMoreButton()}_addCards(t){this._currentCount+=t.length;const e=t.map(t=>{const e=new u(t.source.name,t.title,t.publishedAt,t.description,t.urlToImage,t.url);return this._cardFactory(e,this._cardTemplate).create()});this._container.append(...e)}_resetContainer(){for(;this._container.firstChild;)this._container.removeChild(this._container.firstChild);this._button.style.display=n.e.block,this._currentCount=0,this._totalCount=0}_startLoading(){this._resultFoundElem.style.display=n.e.none,this._failedElem.style.display=n.e.none,this._notFoundElem.style.display=n.e.none,this._loadingElem.style.display=n.e.flex}_showResponse(){this._loadingElem.style.display=n.e.none,0===this._totalCount?(this._notFoundElem.style.display=n.e.flex,this._dataStorage.clear()):(this._resultFoundElem.style.display=n.e.flex,this._hideShowMoreButton())}_hideShowMoreButton(){this._currentCount===this._totalCount&&(this._button.style.display=n.e.none)}_showError(){this._loadingElem.style.display=n.e.none,this._failedElem.style.display=n.e.flex,this._dataStorage.clear()}}(l,(t,e)=>new a(t,e),h,_,d);p.addEventListener();const f=new class{constructor(t,e){this._element=e,this._input=e.querySelector(".search__input"),this._button=e.querySelector(".search__button"),this._sendRequest=t,this._submit=this._submit.bind(this),this._validate=this._validate.bind(this)}addEventListener(){this._element.addEventListener("submit",this._submit),this._element.addEventListener("input",this._validate)}setLSInputValue(t){this._input.value=t,this._button.removeAttribute("disabled"),this._button.classList.add("search__button_active")}_submit(t){t.preventDefault(),this._sendRequest(this._input.value)}_validate(t){t.target.validity.valueMissing&&(this._input.placeholder=n.f.isRequired),this._element.checkValidity()?(this._button.removeAttribute("disabled"),this._button.classList.add("search__button_active")):(this._button.setAttribute("disabled",!0),this._button.classList.remove("search__button_active"))}}(p.render,c);f.addEventListener();const y=_.getKeyword(),m=_.getNews();y&&m&&(f.setLSInputValue(y),p.renderFromLS(m))}]);