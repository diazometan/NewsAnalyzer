!function(t){var e={};function s(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(r,n,function(e){return t[e]}.bind(null,n));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=9)}([function(t,e,s){"use strict";s.d(e,"d",(function(){return r})),s.d(e,"b",(function(){return n})),s.d(e,"c",(function(){return i})),s.d(e,"a",(function(){return o})),s.d(e,"f",(function(){return a})),s.d(e,"e",(function(){return l})),s.d(e,"g",(function(){return u}));const r=3,n=7,i=3,o=20,a={isRequired:"Нужно ввести ключевое слово"},l={none:"none",block:"block",flex:"flex"},u={newsArticles:"newsArticles",newsCount:"newsCount",keyword:"keyword"}},function(t,e,s){"use strict";function r(t){const e=new Date(t).toLocaleDateString("ru-Ru",{day:"numeric",month:"long",year:"numeric"}).slice(0,-3).split(" ");return`${e[0]} ${e[1]}, ${e[2]}`}function n(t){return new Date(t).toLocaleDateString("ru-Ru",{day:"numeric",weekday:"short",month:"long",year:"numeric"})}function i(t){return t.split(", ")[1].split(" ")[1]}function o(t){const e=t.split(", "),s=e[0];return`${e[1].split(" ")[0]}, ${s}`}function a(t){return t.split("T")[0]}s.d(e,"a",(function(){return r})),s.d(e,"b",(function(){return n})),s.d(e,"d",(function(){return i})),s.d(e,"c",(function(){return o})),s.d(e,"e",(function(){return a}))},function(t,e,s){"use strict";s.d(e,"a",(function(){return r}));const r={newsUrl:"http://newsapi.org/v2/",prodNewsUrl:"https://newsapi.org/v2/",newsApiKey:"75f7ee7dea7f44568a2f942cef7db716",githubUrl:"http://api.github.com/repos/diazometan/NewsAnalyzer/commits",prodGithubUrl:"https://api.github.com/repos/diazometan/NewsAnalyzer/commits"}},function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var r=s(0);class n{constructor(){}setNews(t){localStorage.setItem(r.g.newsArticles,JSON.stringify(t.articles)),localStorage.setItem(r.g.newsCount,JSON.stringify(t.totalResults))}getNews(){return JSON.parse(localStorage.getItem(r.g.newsArticles))}getNewsCount(){return localStorage.getItem(r.g.newsCount)}setKeyword(t){localStorage.setItem(r.g.keyword,t)}getKeyword(){return localStorage.getItem(r.g.keyword)}clear(){localStorage.clear()}}},function(t,e,s){},,,,,function(t,e,s){"use strict";s.r(e);s(4);var r=s(2),n=s(0),i=s(1);var o=s(3);class a{constructor(t,e){this._newsInfo=t,this._cardTemplate=e}create(){const t=this._cardTemplate.content.cloneNode(!0).querySelector(".card");t.href=this._newsInfo.urlToNews,this._newsInfo.urlToImage&&(t.querySelector(".card__image").src=this._newsInfo.urlToImage);const e=t.querySelector(".card__text");return e.querySelector(".card__date").textContent=Object(i.a)(this._newsInfo.publishedAt),e.querySelector(".card__title").textContent=this._newsInfo.title,e.querySelector(".card__discription").textContent=this._newsInfo.description,e.querySelector(".card__author").textContent=this._newsInfo.author,t}}class l{constructor(t,e,s,r,n,i){this.author=t,this.title=e,this.publishedAt=Date.parse(s),this.description=r,this.urlToImage=n,this.urlToNews=i}}const u=document.querySelector(".search-result"),d=document.querySelector(".search__form"),c=document.querySelector('[data-component="NewsCardTemplate"]'),h=new class{constructor(t){this._baseUrl=t.baseUrl,this._headers=t.headers,this._apiKey=t.apiKey,this._methods={get:"GET"}}getNews(t){return fetch(this._baseUrl+this._createGetRequestUrl(t),{method:this._methods.get,headers:this._headers}).then(t=>t.ok?t.json():Promise.reject("Ошибка: "+t.status)).catch(t=>{throw t})}_createGetRequestUrl(t){const e=new Date,s=new Date;return s.setDate(s.getDate()-n.b),`everything?q=${t}&language=ru&from=${Object(i.e)(s.toISOString())}&to=${Object(i.e)(e.toISOString())}&page=1&pageSize=100&sortBy=publishedAt&apiKey=`+this._apiKey}}({baseUrl:r.a.prodNewsUrl,apiKey:r.a.newsApiKey,headers:{}}),_=new o.a,b=new class{constructor(t,e,s,r,n){this._container=t.querySelector(".cards"),this._button=t.querySelector(".search-result__button"),this._resultFoundElem=t.querySelector(".search-result__found"),this._loadingElem=t.querySelector(".search-result__loading"),this._notFoundElem=t.querySelector(".search-result__not-found"),this._failedElem=t.querySelector(".search-result__failed"),this._cardFactory=e,this._cardTemplate=n,this._currentCount=0,this._totalCount=0,this._api=s,this._dataStorage=r,this._showMore=this._showMore.bind(this),this.render=this.render.bind(this),this.renderFromLS=this.renderFromLS.bind(this)}addEventListener(){this._button.addEventListener("click",this._showMore)}addFormDisabledCallback(t){this._setFormDisabled=t}addFormEnabledCallback(t){this._setFormEnabled=t}renderFromLS(t){this._resetContainer(),this._totalCount=t.length,this._addCards(t.slice(0,n.d)),this._showResponse()}render(t){this._resetContainer(),this._startLoading(),this._api.getNews(t).then(e=>{this._dataStorage.setNews(e),this._dataStorage.setKeyword(t);const s=e.articles.length>n.d?n.d:e.articles.length;this._totalCount=e.articles.length,this._addCards(e.articles.slice(0,s)),this._showResponse()}).catch(()=>{this._showError()}).finally(()=>this._setFormEnabled())}_showMore(){const t=this._dataStorage.getNews().slice(this._currentCount,this._currentCount+n.d);this._addCards(t),this._hideShowMoreButton()}_addCards(t){this._currentCount+=t.length;const e=t.map(t=>{const e=new l(t.source.name,t.title,t.publishedAt,t.description,t.urlToImage,t.url);return this._cardFactory(e,this._cardTemplate).create()});this._container.append(...e)}_resetContainer(){for(;this._container.firstChild;)this._container.removeChild(this._container.firstChild);this._button.style.display=n.e.block,this._currentCount=0,this._totalCount=0}_startLoading(){this._setFormDisabled(),this._resultFoundElem.style.display=n.e.none,this._failedElem.style.display=n.e.none,this._notFoundElem.style.display=n.e.none,this._loadingElem.style.display=n.e.flex}_showResponse(){this._loadingElem.style.display=n.e.none,0===this._totalCount?(this._notFoundElem.style.display=n.e.flex,this._dataStorage.clear()):(this._resultFoundElem.style.display=n.e.flex,this._hideShowMoreButton())}_hideShowMoreButton(){this._currentCount===this._totalCount&&(this._button.style.display=n.e.none)}_showError(){this._loadingElem.style.display=n.e.none,this._failedElem.style.display=n.e.flex,this._dataStorage.clear()}}(u,(t,e)=>new a(t,e),h,_,c);b.addEventListener();const m=new class{constructor(t,e){this._element=e,this._input=e.querySelector(".search__input"),this._button=e.querySelector(".search__button"),this._sendRequest=t,this._submit=this._submit.bind(this),this._validate=this._validate.bind(this),this.setFormEnabled=this.setFormEnabled.bind(this),this.setFormDisabled=this.setFormDisabled.bind(this)}addEventListener(){this._element.addEventListener("submit",this._submit),this._element.addEventListener("input",this._validate)}setLSInputValue(t){this._input.value=t,this._enabledButton()}setFormDisabled(){this._disableButton(),this._toggleInput()}setFormEnabled(){this._enabledButton(),this._toggleInput()}_submit(t){t.preventDefault(),this._sendRequest(this._input.value)}_validate(t){t.target.validity.valueMissing&&(this._input.placeholder=n.f.isRequired),this._element.checkValidity()?this._enabledButton():this._disableButton()}_disableButton(){this._button.setAttribute("disabled",!0),this._button.classList.remove("search__button_active")}_enabledButton(){this._button.removeAttribute("disabled"),this._button.classList.add("search__button_active")}_toggleInput(){this._input.toggleAttribute("disabled")}}(b.render,d);m.addEventListener(),b.addFormDisabledCallback(m.setFormDisabled),b.addFormEnabledCallback(m.setFormEnabled);const p=_.getKeyword(),f=_.getNews();p&&f&&(m.setLSInputValue(p),b.renderFromLS(f))}]);